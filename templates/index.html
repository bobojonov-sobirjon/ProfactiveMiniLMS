{% extends 'base.html' %}
{% load static %}

{% block title %}Главная - Profactive{% endblock %}

{% block content %}
    <!-- Hero -->
    <section class="max-sm:pt-15 max-md:pt-20 max-lg:pt-32.5 mb-12 md:mb-20 lg:mb-31">
      <div class="relative flex max-md:flex-col md:items-center justify-between gap-x-7 gap-y-8 lg:gap-y-13.5">
        <!-- Left -->
        <div class="flex-1 w-full max-w-145" data-aos="fade-right" data-aos-delay="100">
          <p class="font-medium text-base lg:text-xl text-white/50 mb-3.5">
            Получайте {{ referral_discount.percentage|floatformat:0 }}% с каждой продажи!
          </p>

          {% if main_header %}
            <h1 class="font-bold text-2xl md:text-basic-40 lg:text-[53px]/[64px] mb-11 lg:mb-13.5">
              {{ main_header.get_highlighted_title|safe }}
            </h1>

            <a href="{% url 'about' %}"
              class="block w-fit bg-gradient-display text-primary hover-opacity-75 rounded-[14px] py-3.5 lg:py-5 px-8 lg:px-13.5">
              Узнать подробнее
            </a>
          {% else %}
            <h1 class="font-bold text-2xl md:text-basic-40 lg:text-[53px]/[64px] mb-11 lg:mb-13.5">
              Учебный центр
              <span class="text-gradient-display">Profactive</span>
            </h1>

            <a href="{% url 'referal' %}"
              class="block w-fit bg-gradient-display text-primary hover-opacity-75 rounded-[14px] py-3.5 lg:py-5 px-8 lg:px-13.5">
              Узнать подробнее
            </a>
          {% endif %}
        </div>
        <!-- Right -->
        <div class="flex-1 md:max-w-121 aspect-square md:aspect-[484/544] relative overflow-hidden rounded-3xl" data-aos="fade-left" data-aos-delay="200">
          {% if main_header and main_header.image %}
            <img class="relative z-0 size-full object-cover" src="{{ main_header.image.url }}" alt="{{ main_header.title }}">
          {% else %}
            <img class="relative z-0 size-full object-cover" src="{% static 'assets/images/main-hero.png' %}" alt="img">
          {% endif %}
        </div>

        <div class="max-lg:hidden absolute left-1/2 bottom-1/4 z-0 -translate-x-full translate-y-full">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64" fill="none">
            <path d="M32 0L40.6429 23.3571L64 32L40.6429 40.6429L32 64L23.3571 40.6429L0 32L23.3571 23.3571L32 0Z"
              fill="url(#paint0_linear_0_28)" />
            <defs>
              <linearGradient id="paint0_linear_0_28" x1="49.6592" y1="7.88094" x2="8.16231" y2="34.9448"
                gradientUnits="userSpaceOnUse">
                <stop stop-color="#AB803B" />
                <stop offset="0.235294" stop-color="#CDB14F" />
                <stop offset="0.490196" stop-color="#F0E263" />
                <stop offset="0.733333" stop-color="#D9B84A" />
                <stop offset="1" stop-color="#C28D31" />
              </linearGradient>
            </defs>
          </svg>
        </div>
      </div>
    </section>


    <!-- Каталог курсов -->
    <section class="mb-12 md:mb-20 lg:mb-31">
      <div>
        <h2 class="text-2xl md:text-3xl lg:text-basic-40 md:text-center mb-5 md:mb-8 lg:mb-11" data-aos="fade-up">
          Каталог <span class="text-gradient-display">курсов</span>
        </h2>
        <div class="swiper main-catalog__swiper !px-4 md:!px-6 lg:!px-0 !-mx-4 md:!-mx-6 lg:!-mx-8 xl:!mx-0" data-aos="fade-up" data-aos-delay="200">
          <div class="swiper-wrapper">
            {% for category in main_categories %}
            <div class="swiper-slide">
              <div class="bg-white rounded-3xl p-4 lg:p-6 min-h-50 md:min-h-65 lg:min-h-75.5">
                <div class="bg-gradient-display size-15 md:size-18 lg:size-21 flex items-center justify-center rounded-3xl mb-4 lg:mb-6">
                  {% if category.icon %}
                    <img src="{{ category.icon.url }}" alt="{{ category.name }}" class="w-7 lg:w-10 h-7 lg:h-10 object-contain">
                  {% else %}
                    <!-- Default icon if no custom icon is uploaded -->
                    <svg class="w-7 lg:w-10 h-7 lg:h-10" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M20 0L24.1421 15.8579L40 20L24.1421 24.1421L20 40L15.8579 24.1421L0 20L15.8579 15.8579L20 0Z" fill="#1E1E1E"/>
                    </svg>
                  {% endif %}
                </div>

                <h3 class="text-lg lg:text-basic-23/8.75 text-primary mb-5 md:mb-8 lg:mb-11 line-clamp-1">
                  {{ category.name }}
                </h3>

                <p class="text-primary/50">
                  {{ category.get_total_courses_count }} курсов
                </p>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </section>

    <!-- Популярные курсы -->
    <section class="mb-12 md:mb-20 lg:mb-31">
      <div>
        <h2 class="text-2xl md:text-3xl lg:text-basic-40 md:text-center mb-5 md:mb-8 lg:mb-11">
          <span class="text-gradient-display">Популярные </span>
          курсы
        </h2>

        <div x-data="showMore(6)">
          <div
            class="grid sm:grid-cols-2 lg:grid-cols-3 gap-5 md:gap-8 lg:gap-11 mb-6 md:mb-9 lg:mb-13.5 font-semibold">
            {% for course in popular_courses %}
            <div class="group bg-white rounded-3xl overflow-hidden flex flex-col h-full">
              <div class="h-60 md:h-56 w-full relative overflow-hidden">
                {% if course.image %}
                  <img class="relative z-0 size-full transition duration-200 group-hover:scale-105 object-container scale-[1.05]"
                       src="{{ course.image.url }}" alt="{{ course.name }}">
                {% else %}
                  <img class="relative z-0 size-full transition duration-200 group-hover:scale-105 object-container scale-[1.05]"
                       src="{% static 'assets/images/main-hero.png' %}" alt="{{ course.name }}">
                {% endif %}
              </div>
              <div class="p-4 lg:p-6 flex flex-col flex-1">
                <h4 class="text-primary text-lg lg:text-basic-23/8.75 mb-2 md:mb-3.5 text-force-wrap" style="line-clamp: 2; height: auto; min-height: 60px;">
                  {{ course.name }}
                </h4>
                <p class="text-primary/50 lg:text-lg/7 mb-5 md:mb-8 lg:mb-11 font-medium flex-1 text-force-wrap">
                  {{ course.description|truncatewords:5 }}
                </p>

                <a href="{% url 'courses:course_detail' course.id %}"
                class="block bg-gradient-display hover-opacity-75 text-primary text-lg text-center leading-none rounded-[14px] py-3.5 lg:py-5 mt-auto">
                Подробнее
              </a>
              </div>
            </div>
            {% endfor %}
          </div>

        </div>
      </div>
    </section>

    <!-- Уже зарегистрированы в реферальной программе? -->
    <section class="mb-12 md:mb-20 lg:mb-31">
      <div class="bg-gradient-banner min-h-111 rounded-3xl overflow-hidden">
        <div class="relative flex max-lg:flex-col lg:items-center justify-between gap-x-7 gap-y-6">
          <!-- Left -->
          <div class="px-4 md:px-6 lg:px-13.5 pt-6 lg:py-23.5 flex-1" data-aos="fade-right" data-aos-delay="100">
            <div class="w-full lg:max-w-145">
              <p class="font-medium md:text-lg lg:text-xl text-primary/50 mb-3.5">
                Получайте {% if referral_discount %}{{ referral_discount.percentage|floatformat:0 }}{% else %}6{% endif %}% с каждой продажи!
              </p>

              <h2 class="font-bold text-primary text-2xl md:text-3xl lg:text-basic-40/12.5 mb-6 md:mb-11 lg:mb-13.5">
                Уже зарегистрированы <br class="max-lg:hidden"> в реферальной программе?
              </h2>

              <a href="{% url 'referal' %}" class="inline-block bg-hover-primary font-semibold rounded-[14px] py-3.5 lg:py-5 px-7 lg:px-13.5">
                Узнать подробнее
              </a>
            </div>
          </div>
          <!-- Right -->
          <div class="md:max-w-90.5 relative max-lg:mx-auto lg:mr-32" data-aos="fade-left" data-aos-delay="200">
            <img class="relative z-0 size-full object-cover scale-[1.4]" src="{% static 'assets/images/IMG_20250924_141152_980.png' %}" width="100%" height="100%" alt="img">
          </div>

          <div class="max-lg:hidden absolute left-1/2 bottom-1/4 z-0 -translate-x-full translate-y-full text-primary">
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M32 0L40.6429 23.3571L64 32L40.6429 40.6429L32 64L23.3571 40.6429L0 32L23.3571 23.3571L32 0Z"
                fill="#1E1E1E" fill-opacity="0.882353" />
            </svg>
          </div>
          <div class="max-lg:hidden absolute right-0 top-0 z-0 -translate-x-11 translate-y-11">
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M32 0L40.6429 23.3571L64 32L40.6429 40.6429L32 64L23.3571 40.6429L0 32L23.3571 23.3571L32 0Z"
                fill="#1E1E1E" fill-opacity="0.882353" />
            </svg>
          </div>
        </div>
      </div>
    </section>

    <!-- Почему стоит выбрать -->
    <section class="mb-12 md:mb-20 lg:mb-31">
      <div>
        <h2 class="text-2xl md:text-3xl lg:text-basic-40 md:text-center mb-5 md:mb-8 lg:mb-11" data-aos="fade-up">
          Почему стоит выбрать
          <span class="text-gradient-display">Profactive</span>
        </h2>

        <!-- Video Play -->
        <div class="relative aspect-square md:aspect-[1200/544] max-h-136 overflow-hidden rounded-3xl" data-aos="zoom-in" data-aos-delay="200">
          {% if main_header and main_header.image_banner_video %}
            <img class="relative z-0 size-full object-cover" src="{{ main_header.image_banner_video.url }}" alt="{{ main_header.title }}">
          {% else %}
            <img class="relative z-0 size-full object-cover" src="{% static 'assets/images/popular-2.jpg' %}" alt="Img">
          {% endif %}
          
          <div class="flex items-center justify-center rounded-full absolute z-10 top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2">
            <div class="circle relative rounded-full overflow-hidden size-18 md:size-31 lg:size-41 flex items-center justify-center">
              <button id="playVideoBtn" class="relative z-20 bg-gradient-display size-12 md:size-17.5 lg:size-23.5 rounded-full flex items-center justify-center shrink-0 hover:opacity-80 transition-opacity">
                <svg class="md:ml-2 h-5 md:h-8 w-6 md:w-9 lg:h-11 lg:w-12.5" viewBox="0 0 33 44" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M33 22L0 43.6506V0.349365L33 22Z" fill="#28282C" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Video Modal - Outside of card -->
    {% if main_header and main_header.video %}
      <div id="videoModal" class="fixed inset-0 bg-black bg-opacity-30 z-50 hidden flex items-center justify-center p-4 transition-all duration-300 ease-in-out">
        <div class="relative w-full max-w-3xl md:max-w-4xl lg:max-w-5xl bg-white rounded-3xl overflow-hidden shadow-2xl transform transition-all duration-300 ease-in-out scale-95 opacity-0">
          <!-- Modal Header -->
          <div class="flex items-center justify-between p-6 border-b border-gray-200">
            <h3 class="text-2xl font-bold text-gray-900">Почему стоит выбрать Profactive</h3>
            <button id="closeVideo" class="text-gray-400 hover:text-gray-600 text-3xl font-bold">
              ✕
            </button>
          </div>
          
          <!-- Video Content -->
          <div class="relative aspect-video">
            <video id="modalVideo" class="w-full h-full object-cover" controls>
              <source src="{{ main_header.video.url }}" type="video/mp4">
              <source src="{{ main_header.video.url }}" type="video/webm">
              <source src="{{ main_header.video.url }}" type="video/ogg">
              Ваш браузер не поддерживает видео.
            </video>
          </div>
          
          <!-- Modal Footer -->
          <div class="p-6 bg-gray-50">
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-gradient-display rounded-full flex items-center justify-center">
                  <svg class="w-6 h-6 text-primary" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                  </svg>
                </div>
                <div>
                  <h4 class="font-semibold text-gray-900">Profactive</h4>
                  <p class="text-sm text-gray-600">Учебный центр</p>
                </div>
              </div>
              <div class="text-right">
                <p class="text-sm text-gray-500">Длительность: 10:21</p>
                <p class="text-xs text-gray-400">Рекомендуемый возраст: 6+</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    {% endif %}

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const playBtn = document.getElementById('playVideoBtn');
        const videoModal = document.getElementById('videoModal');
        const modalVideo = document.getElementById('modalVideo');
        const closeBtn = document.getElementById('closeVideo');
        const modalContent = videoModal?.querySelector('.relative');

        if (playBtn && videoModal && modalVideo && modalContent) {
          playBtn.addEventListener('click', function() {
            // Show modal
            videoModal.classList.remove('hidden');
            
            // Trigger animation after a small delay
            setTimeout(() => {
              modalContent.classList.remove('scale-95', 'opacity-0');
              modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
            
            // Play video after animation starts
            setTimeout(() => {
              modalVideo.play();
            }, 200);
          });

          closeBtn.addEventListener('click', function() {
            // Start closing animation
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            
            // Hide modal after animation
            setTimeout(() => {
              videoModal.classList.add('hidden');
              modalVideo.pause();
              modalVideo.currentTime = 0;
            }, 300);
          });

          videoModal.addEventListener('click', function(e) {
            if (e.target === videoModal) {
              // Start closing animation
              modalContent.classList.remove('scale-100', 'opacity-100');
              modalContent.classList.add('scale-95', 'opacity-0');
              
              // Hide modal after animation
              setTimeout(() => {
                videoModal.classList.add('hidden');
                modalVideo.pause();
                modalVideo.currentTime = 0;
              }, 300);
            }
          });
        }
      });
    </script>

{% endblock %}

{% block extra_css %}
<style>
  .text-force-wrap {
    word-break: break-all;
    overflow-wrap: anywhere;
    hyphens: auto;
  }
</style>
{% endblock %}